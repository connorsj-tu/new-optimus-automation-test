 '''Connect to the Bureau Server'''
!path lib/*.jar
!|dbfit.SqlServerTest                                                           |
|Connect|data source=${BureauServer};database=CCRMain;Integrated Security = True|

''' Generate LoadId & ProcessId For Manual Amendments '''
!include -c .CodeStubs.JobControlSystem.StrategicDataQualityAndDataServices.GenerateLoadIdAndProcessId.BaseLoad1
 
 
 ----------------------------- Create required data in Bureau tables ----------------------------------------

!| Execute | Use CCRMain |

 
 
!| Insert    |dbo.Locality                                                         |
|LocalityId? |SubLocality|Locality  |Town      |Deleted|CLoadId      |ULoadId      |
|>>LocalityId|blank      |HALIFAX |WEST YORKSHIRE  |FALSE  |<<BaseLoadId1|<<BaseLoadId1|

!| Insert      |dbo.Domicile                                                                                                                                                                             |
|DomicileId?   |PafStatus   |POBox|Abode|HouseNum|HouseName|Street1            |Street2   |LocalityId  |Postcode|csPostcode|DPS|BFPO     |Deleted|CLoadId      |CSrcId|ULoadId      |USrcId|UProcId      |
|>>DomicileId1 |PXYXXTA000A9|blank|blank|8       |CLARE COURT    |PRESCOTT STREET     |blank     |<<LocalityId|HX1 2QA |1224815872|1Y |FALSE    |FALSE  |<<BaseLoadId1|1     |<<BaseLoadId1|1     |<<BaseLoadId1|
|>>DomicileId2 |PXYXXTA000A9|blank|blank|9       |CLARE COURT    |PRESCOTT STREET     |blank     |<<LocalityId|HX1 2QA |1224815872|1Y |FALSE    |FALSE  |<<BaseLoadId1|1     |<<BaseLoadId1|1     |<<BaseLoadId1|
|>>DomicileId3 |PXYXXTA000A9|blank|blank|10      |CLARE COURT    |PRESCOTT STREET     |blank     |<<LocalityId|HX1 2QA |1224815872|1Y |FALSE    |FALSE  |<<BaseLoadId1|1     |<<BaseLoadId1|1     |<<BaseLoadId1|


'''This is because DBFit uses @@Indenity instead of Scope_Indentity and each Domicile insert will fire a trigger inserts MatchingKey rows'''

!| Query      |Select DomicileId FROM Domicile WHERE CLoadId = @BaseLoadId1 ORDER BY DomicileId|
|DomicileId?                                                                              |
|>>DomicileId1                                                                            |
|>>DomicileId2                                                                            |
|>>DomicileId3                                                                            |




!| Insert    |dbo.Person                                                                                                                                       |
|PersonId?   |TitleId|NameSuffixId|Surname   |Forename  |Othername|Sex|Deleted|CLoadId     |CSrcId|ULoadId      |USrcId|UProcId      |DoBirth   |IndividualId    |
|>>PersonId1 |3      |15          |JERRY     |HARRY     |blank    |F  |FALSE  |<<BaseLoadId1|1     |<<BaseLoadId1|1     |<<BaseLoadId1|15/07/1987|NULL |
|>>PersonId2 |3      |15          |JERRY     |SAM      |blank    |F  |FALSE  |<<BaseLoadId1|1     |<<BaseLoadId1|1     |<<BaseLoadId1|15/01/1987|NULL |


!| Query|Select PersonId FROM Person WHERE CLoadId = @BaseLoadId1 ORDER BY PersonId|
|PersonId?                                                                    |
|>>PersonId1                                                                  |
|>>PersonId2                                                                  |


'''This is because DBFit uses @@Indenity instead of Scope_Indentity and a each Residence insert will fire a trigger inserts MatchingKey rows'''


!| Insert       |dbo.Residence                                                                                                                  |
|ResidenceId?   |PersonId    |DomicileId   |DateMoveIn|DateMoveOut|HouseholdComp|Deleted|CLoadId      |CSrcId|ULoadId      |USrcId|UProcId      |
|>>ResidenceId1 |<<PersonId1 |<<DomicileId1|01/01/2010|NULL       |NULL         |FALSE  |<<BaseLoadId1|1     |<<BaseLoadId1|1     |<<BaseLoadId1|
|>>ResidenceId2 |<<PersonId1 |<<DomicileId2|01/01/2000|31/12/2004 |NULL         |FALSE  |<<BaseLoadId1|3     |<<BaseLoadId1|3     |<<BaseLoadId1|
|>>ResidenceId3 |<<PersonId2 |<<DomicileId3|01/01/2012|NULL       |NULL         |FALSE  |<<BaseLoadId1|4     |<<BaseLoadId1|4     |<<BaseLoadId1|




!| Query|Select ResidenceId FROM Residence WHERE CLoadId = @BaseLoadId1 ORDER BY ResidenceId|
|ResidenceId?                                                                          |
|>>ResidenceId1                                                                        |
|>>ResidenceId2                                                                        |
|>>ResidenceId3                                                                        |




!|insert         |dbo.AddressLink                                                                    |
|AddLinkId?      |ResId           |LinkResId       |Deleted|UProcId      |ULoadId      |CLoadId      |
|>>AddLinkId1aD  |<<ResidenceId1  |<<ResidenceId2 |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|
|>>AddLinkId1bD  |<<ResidenceId2 |<<ResidenceId3 |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|
|>>AddLinkId1aDR  |<<ResidenceId2  |<<ResidenceId1 |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|
|>>AddLinkId1bDR  |<<ResidenceId3 |<<ResidenceId2 |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|
|>>AddLinkId1aI |<<ResidenceId1 |<<ResidenceId3  |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|
|>>AddLinkId1aIR |<<ResidenceId3 |<<ResidenceId1  |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|




!|Query|Select AddLinkId FROM dbo.AddressLink WHERE CLoadId = @BaseLoadId1 ORDER BY AddLinkId|
|AddLinkId?                                                               |
|>>AddLinkId1aD  |
|>>AddLinkId1bD  |
|>>AddLinkId1aDR | 
|>>AddLinkId1bDR |
|>>AddLinkId1aI  |
|>>AddLinkId1aIR |





!|insert|dbo.AddressLinkSource|
|AddLinkId    |CLoadId      |CSrcId|BLoadId      |BSrcId|UProcId|Deleted|Implied|DataOrigin|SourceId?           |ULoadId      |
|<<AddLinkId1aD |<<BaseLoadId1|1 |<<BaseLoadId1|1 |<<BaseLoadId1|FALSE|FALSE|FALSE  |>>AddLinkSource1aD |<<BaseLoadId1|
|<<AddLinkId1bD |<<BaseLoadId1|2 |<<BaseLoadId1|2 |<<BaseLoadId1|FALSE|FALSE|FALSE  |>>AddLinkSource1bD |<<BaseLoadId1|
|<<AddLinkId1aDR|<<BaseLoadId1|6 |<<BaseLoadId1|6 |<<BaseLoadId1|FALSE|FALSE|TRUE |>>AddLinkSource1aDR|<<BaseLoadId1|
|<<AddLinkId1bDR|<<BaseLoadId1|7 |<<BaseLoadId1|7 |<<BaseLoadId1|FALSE|FALSE|TRUE |>>AddLinkSource1bDR|<<BaseLoadId1|
|<<AddLinkId1aI |<<BaseLoadId1|11 |<<BaseLoadId1|11 |<<BaseLoadId1|FALSE|TRUE |FALSE|>>AddLinkSource1aI |<<BaseLoadId1|
|<<AddLinkId1aIR|<<BaseLoadId1|21|<<BaseLoadId1|21|<<BaseLoadId1|FALSE|FALSE|TRUE |>>AddLinkSource1aIR|<<BaseLoadId1|



!|insert    |dbo.PersonAlias                                                                     |
|AliasId?   |PersonId    |PersonLinkId|Deleted|UProcId      |ULoadId      |CLoadId      |DisAlias|
|>>AliasId1 |<<PersonId1 |<<PersonId2 |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|False   |
|>>AliasId2 |<<PersonId2 |<<PersonId1 |False  |<<BaseLoadId1|<<BaseLoadId1|<<BaseLoadId1|False   |



!|Query|Select AliasId FROM dbo.PersonAlias WHERE CLoadId = @BaseLoadId1 ORDER BY AliasId|
|AliasId?                                                                           |
|>>AliasId1                                                                         |
|>>AliasId2                                                                         |


!|insert     |dbo.PersonAliasSource                                                                                                             |
|AliasId     |CLoadId      |CSrcId|BLoadId      |BSrcId|UProcId      |Implied|Deleted|DataOrigin|SourceId?               |ULoadId      |Disalias|
|<<AliasId1  |<<BaseLoadId1|1     |<<BaseLoadId1|1     |<<BaseLoadId1|False  |False  |True      |>>PersonAliasSourceId1  |<<BaseLoadId1|False   |
|<<AliasId2  |<<BaseLoadId1|2     |<<BaseLoadId1|2     |<<BaseLoadId1|False  |False  |True      |>>PersonAliasSourceId2  |<<BaseLoadId1|False   |


!| commit |

